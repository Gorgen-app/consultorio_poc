{
  "query": "\n-- Tabela: calendars\nCREATE TABLE IF NOT EXISTS calendars (\n  id VARCHAR(36) PRIMARY KEY,\n  tenant_id VARCHAR(36) NOT NULL,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  timezone VARCHAR(50) DEFAULT 'America/Sao_Paulo',\n  color VARCHAR(7) DEFAULT '#3B82F6',\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_tenant (tenant_id)\n);\n\n-- Tabela: events\nCREATE TABLE IF NOT EXISTS events (\n  id VARCHAR(36) PRIMARY KEY,\n  calendar_id VARCHAR(36) NOT NULL,\n  title VARCHAR(255) NOT NULL,\n  category ENUM('consulta', 'cirurgia', 'procedimento', 'visita_internado', 'exame', 'reuniao', 'outro') NOT NULL,\n  description TEXT,\n  start_at DATETIME NOT NULL,\n  end_at DATETIME NOT NULL,\n  timezone VARCHAR(50) DEFAULT 'America/Sao_Paulo',\n  all_day BOOLEAN DEFAULT FALSE,\n  visibility ENUM('public', 'private', 'confidential') DEFAULT 'private',\n  busy_status ENUM('busy', 'free', 'tentative') DEFAULT 'busy',\n  etag VARCHAR(64),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  created_by VARCHAR(36),\n  INDEX idx_calendar_start (calendar_id, start_at),\n  INDEX idx_category (category),\n  INDEX idx_visibility (visibility)\n);\n\n-- Tabela: consultations\nCREATE TABLE IF NOT EXISTS consultations (\n  event_id VARCHAR(36) PRIMARY KEY,\n  patient_id VARCHAR(36) NOT NULL,\n  professional_id VARCHAR(36),\n  payer_type ENUM('particular', 'convenio') DEFAULT 'particular',\n  payer_id VARCHAR(36),\n  payer_name VARCHAR(255),\n  plan_name VARCHAR(255),\n  member_id VARCHAR(50),\n  authorization_required BOOLEAN DEFAULT FALSE,\n  authorization_number VARCHAR(50),\n  status ENUM('agendado', 'confirmado', 'aguardando', 'em_consulta', 'finalizado', 'cancelado') DEFAULT 'agendado',\n  attendance_started_at DATETIME,\n  attendance_ended_at DATETIME,\n  chief_complaint VARCHAR(500),\n  notes TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_patient (patient_id),\n  INDEX idx_professional (professional_id),\n  INDEX idx_status (status),\n  INDEX idx_payer (payer_id)\n);\n\n-- Tabela: consultation_status_log\nCREATE TABLE IF NOT EXISTS consultation_status_log (\n  id VARCHAR(36) PRIMARY KEY,\n  event_id VARCHAR(36) NOT NULL,\n  from_status ENUM('agendado', 'confirmado', 'aguardando', 'em_consulta', 'finalizado', 'cancelado'),\n  to_status ENUM('agendado', 'confirmado', 'aguardando', 'em_consulta', 'finalizado', 'cancelado') NOT NULL,\n  changed_at DATETIME NOT NULL,\n  changed_by_user_id VARCHAR(36) NOT NULL,\n  note TEXT,\n  INDEX idx_event (event_id),\n  INDEX idx_changed_at (changed_at),\n  INDEX idx_changed_by (changed_by_user_id)\n);\n\n-- Tabela: calendar_acl\nCREATE TABLE IF NOT EXISTS calendar_acl (\n  id VARCHAR(36) PRIMARY KEY,\n  calendar_id VARCHAR(36) NOT NULL,\n  user_id VARCHAR(36) NOT NULL,\n  role ENUM('owner', 'editor', 'viewer') DEFAULT 'viewer',\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_calendar_user (calendar_id, user_id),\n  INDEX idx_calendar (calendar_id),\n  INDEX idx_user (user_id)\n);\n\n-- Tabela: audit_log\nCREATE TABLE IF NOT EXISTS audit_log (\n  id VARCHAR(36) PRIMARY KEY,\n  tenant_id VARCHAR(36) NOT NULL,\n  table_name VARCHAR(50) NOT NULL,\n  operation ENUM('CREATE', 'UPDATE', 'DELETE') NOT NULL,\n  record_id VARCHAR(36) NOT NULL,\n  user_id VARCHAR(36) NOT NULL,\n  old_values JSON,\n  new_values JSON,\n  timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n  ip_address VARCHAR(45),\n  user_agent TEXT,\n  INDEX idx_timestamp (timestamp),\n  INDEX idx_user (user_id),\n  INDEX idx_record (table_name, record_id)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2eJNWYGY92vZU3w.root --database TyeFpW5ykZHTuZXuk6iMG7 --execute \n-- Tabela: calendars\nCREATE TABLE IF NOT EXISTS calendars (\n  id VARCHAR(36) PRIMARY KEY,\n  tenant_id VARCHAR(36) NOT NULL,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  timezone VARCHAR(50) DEFAULT 'America/Sao_Paulo',\n  color VARCHAR(7) DEFAULT '#3B82F6',\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_tenant (tenant_id)\n);\n\n-- Tabela: events\nCREATE TABLE IF NOT EXISTS events (\n  id VARCHAR(36) PRIMARY KEY,\n  calendar_id VARCHAR(36) NOT NULL,\n  title VARCHAR(255) NOT NULL,\n  category ENUM('consulta', 'cirurgia', 'procedimento', 'visita_internado', 'exame', 'reuniao', 'outro') NOT NULL,\n  description TEXT,\n  start_at DATETIME NOT NULL,\n  end_at DATETIME NOT NULL,\n  timezone VARCHAR(50) DEFAULT 'America/Sao_Paulo',\n  all_day BOOLEAN DEFAULT FALSE,\n  visibility ENUM('public', 'private', 'confidential') DEFAULT 'private',\n  busy_status ENUM('busy', 'free', 'tentative') DEFAULT 'busy',\n  etag VARCHAR(64),\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  created_by VARCHAR(36),\n  INDEX idx_calendar_start (calendar_id, start_at),\n  INDEX idx_category (category),\n  INDEX idx_visibility (visibility)\n);\n\n-- Tabela: consultations\nCREATE TABLE IF NOT EXISTS consultations (\n  event_id VARCHAR(36) PRIMARY KEY,\n  patient_id VARCHAR(36) NOT NULL,\n  professional_id VARCHAR(36),\n  payer_type ENUM('particular', 'convenio') DEFAULT 'particular',\n  payer_id VARCHAR(36),\n  payer_name VARCHAR(255),\n  plan_name VARCHAR(255),\n  member_id VARCHAR(50),\n  authorization_required BOOLEAN DEFAULT FALSE,\n  authorization_number VARCHAR(50),\n  status ENUM('agendado', 'confirmado', 'aguardando', 'em_consulta', 'finalizado', 'cancelado') DEFAULT 'agendado',\n  attendance_started_at DATETIME,\n  attendance_ended_at DATETIME,\n  chief_complaint VARCHAR(500),\n  notes TEXT,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  INDEX idx_patient (patient_id),\n  INDEX idx_professional (professional_id),\n  INDEX idx_status (status),\n  INDEX idx_payer (payer_id)\n);\n\n-- Tabela: consultation_status_log\nCREATE TABLE IF NOT EXISTS consultation_status_log (\n  id VARCHAR(36) PRIMARY KEY,\n  event_id VARCHAR(36) NOT NULL,\n  from_status ENUM('agendado', 'confirmado', 'aguardando', 'em_consulta', 'finalizado', 'cancelado'),\n  to_status ENUM('agendado', 'confirmado', 'aguardando', 'em_consulta', 'finalizado', 'cancelado') NOT NULL,\n  changed_at DATETIME NOT NULL,\n  changed_by_user_id VARCHAR(36) NOT NULL,\n  note TEXT,\n  INDEX idx_event (event_id),\n  INDEX idx_changed_at (changed_at),\n  INDEX idx_changed_by (changed_by_user_id)\n);\n\n-- Tabela: calendar_acl\nCREATE TABLE IF NOT EXISTS calendar_acl (\n  id VARCHAR(36) PRIMARY KEY,\n  calendar_id VARCHAR(36) NOT NULL,\n  user_id VARCHAR(36) NOT NULL,\n  role ENUM('owner', 'editor', 'viewer') DEFAULT 'viewer',\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  UNIQUE KEY unique_calendar_user (calendar_id, user_id),\n  INDEX idx_calendar (calendar_id),\n  INDEX idx_user (user_id)\n);\n\n-- Tabela: audit_log\nCREATE TABLE IF NOT EXISTS audit_log (\n  id VARCHAR(36) PRIMARY KEY,\n  tenant_id VARCHAR(36) NOT NULL,\n  table_name VARCHAR(50) NOT NULL,\n  operation ENUM('CREATE', 'UPDATE', 'DELETE') NOT NULL,\n  record_id VARCHAR(36) NOT NULL,\n  user_id VARCHAR(36) NOT NULL,\n  old_values JSON,\n  new_values JSON,\n  timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,\n  ip_address VARCHAR(45),\n  user_agent TEXT,\n  INDEX idx_timestamp (timestamp),\n  INDEX idx_user (user_id),\n  INDEX idx_record (table_name, record_id)\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 98
}