{
  "query": "-- Alterar coluna cpf para TEXT e adicionar cpf_hash\nALTER TABLE pacientes MODIFY COLUMN cpf TEXT;\nALTER TABLE pacientes ADD COLUMN IF NOT EXISTS cpf_hash VARCHAR(64);\n\n-- Alterar coluna email para TEXT e adicionar email_hash\nALTER TABLE pacientes MODIFY COLUMN email TEXT;\nALTER TABLE pacientes ADD COLUMN IF NOT EXISTS email_hash VARCHAR(64);\n\n-- Alterar coluna telefone para TEXT e adicionar telefone_hash\nALTER TABLE pacientes MODIFY COLUMN telefone TEXT;\nALTER TABLE pacientes ADD COLUMN IF NOT EXISTS telefone_hash VARCHAR(64);\n\n-- Criar índices para busca por hash\nCREATE INDEX IF NOT EXISTS idx_pacientes_tenant_cpf_hash ON pacientes(tenant_id, cpf_hash);\nCREATE INDEX IF NOT EXISTS idx_pacientes_tenant_email_hash ON pacientes(tenant_id, email_hash);\nCREATE INDEX IF NOT EXISTS idx_pacientes_tenant_telefone_hash ON pacientes(tenant_id, telefone_hash);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2eJNWYGY92vZU3w.root --database TyeFpW5ykZHTuZXuk6iMG7 --execute -- Alterar coluna cpf para TEXT e adicionar cpf_hash\nALTER TABLE pacientes MODIFY COLUMN cpf TEXT;\nALTER TABLE pacientes ADD COLUMN IF NOT EXISTS cpf_hash VARCHAR(64);\n\n-- Alterar coluna email para TEXT e adicionar email_hash\nALTER TABLE pacientes MODIFY COLUMN email TEXT;\nALTER TABLE pacientes ADD COLUMN IF NOT EXISTS email_hash VARCHAR(64);\n\n-- Alterar coluna telefone para TEXT e adicionar telefone_hash\nALTER TABLE pacientes MODIFY COLUMN telefone TEXT;\nALTER TABLE pacientes ADD COLUMN IF NOT EXISTS telefone_hash VARCHAR(64);\n\n-- Criar índices para busca por hash\nCREATE INDEX IF NOT EXISTS idx_pacientes_tenant_cpf_hash ON pacientes(tenant_id, cpf_hash);\nCREATE INDEX IF NOT EXISTS idx_pacientes_tenant_email_hash ON pacientes(tenant_id, email_hash);\nCREATE INDEX IF NOT EXISTS idx_pacientes_tenant_telefone_hash ON pacientes(tenant_id, telefone_hash);",
  "returncode": 1,
  "logs": [
    "ERROR 1170 (42000) at line 2: BLOB/TEXT column 'cpf' used in key specification without a key length"
  ]
}