{
  "query": "\n-- Criar tabela de solicitações cirúrgicas\nCREATE TABLE IF NOT EXISTS solicitacoes_cirurgicas (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  tenant_id INT NOT NULL,\n  id_solicitacao VARCHAR(20) NOT NULL UNIQUE,\n  paciente_id INT NOT NULL,\n  paciente_nome VARCHAR(255),\n  procedimento VARCHAR(500) NOT NULL,\n  codigo_procedimento VARCHAR(50),\n  lateralidade ENUM('Direita', 'Esquerda', 'Bilateral', 'N/A') DEFAULT 'N/A',\n  convenio VARCHAR(100),\n  numero_carteirinha VARCHAR(50),\n  plano VARCHAR(100),\n  hospital VARCHAR(255),\n  sala_operatoria VARCHAR(50),\n  data_solicitacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  data_prevista DATE,\n  hora_previsto_inicio VARCHAR(5),\n  hora_previsto_fim VARCHAR(5),\n  tempo_sala_minutos INT DEFAULT 120,\n  cirurgiao_id INT,\n  cirurgiao_nome VARCHAR(255),\n  auxiliar_1 VARCHAR(255),\n  auxiliar_2 VARCHAR(255),\n  anestesista VARCHAR(255),\n  tipo_anestesia VARCHAR(100),\n  materiais_especiais LONGTEXT,\n  opme LONGTEXT,\n  exame_comprobatorio_url VARCHAR(500),\n  exame_comprobatorio_tipo VARCHAR(100),\n  guia_pdf_url VARCHAR(500),\n  guia_internacao_url VARCHAR(500),\n  guia_opme_url VARCHAR(500),\n  guias_enviadas_em TIMESTAMP NULL,\n  guias_enviadas_para VARCHAR(255),\n  numero_autorizacao VARCHAR(50),\n  data_autorizacao TIMESTAMP NULL,\n  validade_autorizacao DATE,\n  observacoes_autorizacao LONGTEXT,\n  data_confirmacao TIMESTAMP NULL,\n  confirmado_por VARCHAR(255),\n  status ENUM('Pendente de Guias', 'Guias Geradas', 'Guias Enviadas', 'Em Análise', 'Autorizada', 'Negada', 'Confirmada', 'Realizada', 'Cancelada') DEFAULT 'Pendente de Guias',\n  indicacao_cirurgica LONGTEXT,\n  observacoes LONGTEXT,\n  agendamento_id INT,\n  cirurgia_id INT,\n  criado_por VARCHAR(255),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (tenant_id) REFERENCES tenants(id),\n  FOREIGN KEY (paciente_id) REFERENCES pacientes(id),\n  FOREIGN KEY (cirurgiao_id) REFERENCES users(id),\n  FOREIGN KEY (agendamento_id) REFERENCES agendamentos(id),\n  FOREIGN KEY (cirurgia_id) REFERENCES cirurgias(id)\n);\n\n-- Criar tabela de histórico de solicitações cirúrgicas\nCREATE TABLE IF NOT EXISTS historico_solicitacao_cirurgica (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  tenant_id INT NOT NULL,\n  solicitacao_id INT NOT NULL,\n  status_anterior VARCHAR(50),\n  status_novo VARCHAR(50) NOT NULL,\n  observacao LONGTEXT,\n  alterado_por VARCHAR(255),\n  alterado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  ip_address VARCHAR(45),\n  user_agent VARCHAR(500),\n  FOREIGN KEY (tenant_id) REFERENCES tenants(id),\n  FOREIGN KEY (solicitacao_id) REFERENCES solicitacoes_cirurgicas(id)\n);\n\n-- Criar tabela de profissionais\nCREATE TABLE IF NOT EXISTS profissionais (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  tenant_id INT NOT NULL,\n  nome VARCHAR(255) NOT NULL,\n  crm VARCHAR(20),\n  especialidade VARCHAR(100),\n  user_id INT,\n  cor_agenda VARCHAR(7) DEFAULT '#3B82F6',\n  duracao_consulta_padrao INT DEFAULT 30,\n  ativo BOOLEAN DEFAULT TRUE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (tenant_id) REFERENCES tenants(id),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\n-- Adicionar coluna profissional_id à tabela agendamentos se não existir\nALTER TABLE agendamentos ADD COLUMN IF NOT EXISTS profissional_id INT AFTER paciente_id;\nALTER TABLE agendamentos ADD FOREIGN KEY (profissional_id) REFERENCES profissionais(id);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2eJNWYGY92vZU3w.root --database TyeFpW5ykZHTuZXuk6iMG7 --execute \n-- Criar tabela de solicitações cirúrgicas\nCREATE TABLE IF NOT EXISTS solicitacoes_cirurgicas (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  tenant_id INT NOT NULL,\n  id_solicitacao VARCHAR(20) NOT NULL UNIQUE,\n  paciente_id INT NOT NULL,\n  paciente_nome VARCHAR(255),\n  procedimento VARCHAR(500) NOT NULL,\n  codigo_procedimento VARCHAR(50),\n  lateralidade ENUM('Direita', 'Esquerda', 'Bilateral', 'N/A') DEFAULT 'N/A',\n  convenio VARCHAR(100),\n  numero_carteirinha VARCHAR(50),\n  plano VARCHAR(100),\n  hospital VARCHAR(255),\n  sala_operatoria VARCHAR(50),\n  data_solicitacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  data_prevista DATE,\n  hora_previsto_inicio VARCHAR(5),\n  hora_previsto_fim VARCHAR(5),\n  tempo_sala_minutos INT DEFAULT 120,\n  cirurgiao_id INT,\n  cirurgiao_nome VARCHAR(255),\n  auxiliar_1 VARCHAR(255),\n  auxiliar_2 VARCHAR(255),\n  anestesista VARCHAR(255),\n  tipo_anestesia VARCHAR(100),\n  materiais_especiais LONGTEXT,\n  opme LONGTEXT,\n  exame_comprobatorio_url VARCHAR(500),\n  exame_comprobatorio_tipo VARCHAR(100),\n  guia_pdf_url VARCHAR(500),\n  guia_internacao_url VARCHAR(500),\n  guia_opme_url VARCHAR(500),\n  guias_enviadas_em TIMESTAMP NULL,\n  guias_enviadas_para VARCHAR(255),\n  numero_autorizacao VARCHAR(50),\n  data_autorizacao TIMESTAMP NULL,\n  validade_autorizacao DATE,\n  observacoes_autorizacao LONGTEXT,\n  data_confirmacao TIMESTAMP NULL,\n  confirmado_por VARCHAR(255),\n  status ENUM('Pendente de Guias', 'Guias Geradas', 'Guias Enviadas', 'Em Análise', 'Autorizada', 'Negada', 'Confirmada', 'Realizada', 'Cancelada') DEFAULT 'Pendente de Guias',\n  indicacao_cirurgica LONGTEXT,\n  observacoes LONGTEXT,\n  agendamento_id INT,\n  cirurgia_id INT,\n  criado_por VARCHAR(255),\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (tenant_id) REFERENCES tenants(id),\n  FOREIGN KEY (paciente_id) REFERENCES pacientes(id),\n  FOREIGN KEY (cirurgiao_id) REFERENCES users(id),\n  FOREIGN KEY (agendamento_id) REFERENCES agendamentos(id),\n  FOREIGN KEY (cirurgia_id) REFERENCES cirurgias(id)\n);\n\n-- Criar tabela de histórico de solicitações cirúrgicas\nCREATE TABLE IF NOT EXISTS historico_solicitacao_cirurgica (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  tenant_id INT NOT NULL,\n  solicitacao_id INT NOT NULL,\n  status_anterior VARCHAR(50),\n  status_novo VARCHAR(50) NOT NULL,\n  observacao LONGTEXT,\n  alterado_por VARCHAR(255),\n  alterado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  ip_address VARCHAR(45),\n  user_agent VARCHAR(500),\n  FOREIGN KEY (tenant_id) REFERENCES tenants(id),\n  FOREIGN KEY (solicitacao_id) REFERENCES solicitacoes_cirurgicas(id)\n);\n\n-- Criar tabela de profissionais\nCREATE TABLE IF NOT EXISTS profissionais (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  tenant_id INT NOT NULL,\n  nome VARCHAR(255) NOT NULL,\n  crm VARCHAR(20),\n  especialidade VARCHAR(100),\n  user_id INT,\n  cor_agenda VARCHAR(7) DEFAULT '#3B82F6',\n  duracao_consulta_padrao INT DEFAULT 30,\n  ativo BOOLEAN DEFAULT TRUE,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (tenant_id) REFERENCES tenants(id),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);\n\n-- Adicionar coluna profissional_id à tabela agendamentos se não existir\nALTER TABLE agendamentos ADD COLUMN IF NOT EXISTS profissional_id INT AFTER paciente_id;\nALTER TABLE agendamentos ADD FOREIGN KEY (profissional_id) REFERENCES profissionais(id);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 2014
}