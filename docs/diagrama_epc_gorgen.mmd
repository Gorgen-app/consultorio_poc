%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f4f8', 'primaryTextColor': '#1a365d', 'primaryBorderColor': '#2c5282', 'lineColor': '#4a5568', 'secondaryColor': '#f0fff4', 'tertiaryColor': '#fef3c7'}}}%%
flowchart TB
    subgraph TITULO["ğŸ¥ GORGEN - Sistema de GestÃ£o em SaÃºde<br/>Diagrama EPC (Event-driven Process Chain)"]
    end

    %% ========================================
    %% PROCESSO 1: GESTÃƒO DE PACIENTES
    %% ========================================
    subgraph GP["ğŸ“‹ GESTÃƒO DE PACIENTES"]
        direction TB
        
        E1([ğŸ”µ Novo paciente<br/>chega ao consultÃ³rio])
        F1[/ğŸ“ Cadastrar<br/>Paciente/]
        E2([ğŸŸ¢ Paciente<br/>cadastrado])
        
        E3([ğŸ”µ Dados do paciente<br/>precisam atualizaÃ§Ã£o])
        F2[/âœï¸ Editar<br/>Paciente/]
        E4([ğŸŸ¢ Dados<br/>atualizados])
        
        E5([ğŸ”µ Busca por<br/>paciente necessÃ¡ria])
        F3[/ğŸ” Buscar/Filtrar<br/>Pacientes/]
        E6([ğŸŸ¢ Paciente<br/>localizado])
        
        E1 --> F1 --> E2
        E3 --> F2 --> E4
        E5 --> F3 --> E6
    end

    %% ========================================
    %% PROCESSO 2: AGENDAMENTO
    %% ========================================
    subgraph AG["ğŸ“… AGENDAMENTO"]
        direction TB
        
        E7([ğŸ”µ SolicitaÃ§Ã£o de<br/>consulta recebida])
        F4[/ğŸ“† Verificar<br/>Disponibilidade/]
        X1{HorÃ¡rio<br/>disponÃ­vel?}
        F5[/âœ… Agendar<br/>Consulta/]
        E8([ğŸŸ¢ Consulta<br/>agendada])
        F6[/ğŸ“§ Enviar<br/>ConfirmaÃ§Ã£o/]
        E9([ğŸŸ¢ Paciente<br/>notificado])
        
        E10([ğŸ”µ Paciente solicita<br/>cancelamento])
        F7[/âŒ Cancelar<br/>Agendamento/]
        E11([ğŸŸ¢ Agendamento<br/>cancelado])
        
        E7 --> F4 --> X1
        X1 -->|Sim| F5 --> E8 --> F6 --> E9
        X1 -->|NÃ£o| E7
        E10 --> F7 --> E11
    end

    %% ========================================
    %% PROCESSO 3: ATENDIMENTO MÃ‰DICO
    %% ========================================
    subgraph AT["ğŸ©º ATENDIMENTO MÃ‰DICO"]
        direction TB
        
        E12([ğŸ”µ Paciente chega<br/>para consulta])
        F8[/ğŸ“‹ Registrar<br/>Atendimento/]
        E13([ğŸŸ¢ Atendimento<br/>iniciado])
        
        F9[/ğŸ“ Preencher<br/>EvoluÃ§Ã£o SOAP/]
        E14([ğŸŸ¢ EvoluÃ§Ã£o<br/>registrada])
        
        X2{Exames<br/>necessÃ¡rios?}
        F10[/ğŸ“„ Solicitar<br/>Exames/]
        E15([ğŸŸ¢ SolicitaÃ§Ã£o<br/>gerada])
        
        X3{PrescriÃ§Ã£o<br/>necessÃ¡ria?}
        F11[/ğŸ’Š Emitir<br/>Receita/]
        E16([ğŸŸ¢ Receita<br/>emitida])
        
        F12[/ğŸ“‹ Finalizar<br/>Atendimento/]
        E17([ğŸŸ¢ Atendimento<br/>concluÃ­do])
        
        E12 --> F8 --> E13 --> F9 --> E14
        E14 --> X2
        X2 -->|Sim| F10 --> E15 --> X3
        X2 -->|NÃ£o| X3
        X3 -->|Sim| F11 --> E16 --> F12
        X3 -->|NÃ£o| F12
        F12 --> E17
    end

    %% ========================================
    %% PROCESSO 4: PRONTUÃRIO ELETRÃ”NICO
    %% ========================================
    subgraph PR["ğŸ“ PRONTUÃRIO ELETRÃ”NICO"]
        direction TB
        
        E18([ğŸ”µ Acesso ao<br/>prontuÃ¡rio solicitado])
        F13[/ğŸ” Verificar<br/>PermissÃ£o/]
        X4{Autorizado?}
        F14[/ğŸ“– Exibir<br/>ProntuÃ¡rio/]
        E19([ğŸŸ¢ ProntuÃ¡rio<br/>visualizado])
        
        E20([ğŸ”µ Documento externo<br/>recebido])
        F15[/ğŸ“¤ Upload de<br/>Documento/]
        F16[/ğŸ¤– Extrair OCR<br/>e Dados/]
        E21([ğŸŸ¢ Documento<br/>indexado])
        
        E22([ğŸ”µ Medida<br/>antropomÃ©trica nova])
        F17[/ğŸ“Š Registrar<br/>Medida/]
        E23([ğŸŸ¢ HistÃ³rico<br/>atualizado])
        
        E18 --> F13 --> X4
        X4 -->|Sim| F14 --> E19
        X4 -->|NÃ£o| E24([ğŸ”´ Acesso<br/>negado])
        
        E20 --> F15 --> F16 --> E21
        E22 --> F17 --> E23
    end

    %% ========================================
    %% PROCESSO 5: FATURAMENTO
    %% ========================================
    subgraph FA["ğŸ’° FATURAMENTO"]
        direction TB
        
        E25([ğŸ”µ Atendimento<br/>realizado])
        F18[/ğŸ’µ Calcular<br/>HonorÃ¡rios/]
        E26([ğŸŸ¢ Valor<br/>calculado])
        
        F19[/ğŸ“¨ Enviar para<br/>Faturamento/]
        E27([ğŸŸ¢ Fatura<br/>enviada])
        
        E28([ğŸ”µ Pagamento<br/>recebido])
        F20[/âœ… Registrar<br/>Pagamento/]
        E29([ğŸŸ¢ Pagamento<br/>confirmado])
        
        F21[/ğŸ“Š Atualizar<br/>Dashboard/]
        E30([ğŸŸ¢ MÃ©tricas<br/>atualizadas])
        
        E25 --> F18 --> E26 --> F19 --> E27
        E28 --> F20 --> E29 --> F21 --> E30
    end

    %% ========================================
    %% PROCESSO 6: COMPARTILHAMENTO CROSS-TENANT
    %% ========================================
    subgraph CT["ğŸ”„ COMPARTILHAMENTO CROSS-TENANT"]
        direction TB
        
        E31([ğŸ”µ ClÃ­nica externa<br/>solicita acesso])
        F22[/ğŸ“© Criar<br/>SolicitaÃ§Ã£o/]
        E32([ğŸŸ¡ SolicitaÃ§Ã£o<br/>pendente])
        
        F23[/ğŸ“§ Notificar<br/>ClÃ­nica Origem/]
        E33([ğŸŸ¢ NotificaÃ§Ã£o<br/>enviada])
        
        X5{Paciente<br/>autoriza?}
        F24[/âœ… Aprovar com<br/>Consentimento LGPD/]
        E34([ğŸŸ¢ Acesso<br/>autorizado])
        
        F25[/âŒ Rejeitar<br/>SolicitaÃ§Ã£o/]
        E35([ğŸ”´ Acesso<br/>negado])
        
        E36([ğŸ”µ Acesso<br/>cross-tenant])
        F26[/ğŸ“ Registrar<br/>Log Auditoria/]
        E37([ğŸŸ¢ Acesso<br/>auditado])
        
        E38([ğŸ”µ AutorizaÃ§Ã£o<br/>nÃ£o mais necessÃ¡ria])
        F27[/ğŸš« Revogar<br/>AutorizaÃ§Ã£o/]
        E39([ğŸŸ¢ Acesso<br/>revogado])
        
        E31 --> F22 --> E32 --> F23 --> E33 --> X5
        X5 -->|Sim| F24 --> E34
        X5 -->|NÃ£o| F25 --> E35
        E36 --> F26 --> E37
        E38 --> F27 --> E39
    end

    %% ========================================
    %% PROCESSO 7: AUDITORIA E CONFORMIDADE
    %% ========================================
    subgraph AU["ğŸ”’ AUDITORIA E CONFORMIDADE"]
        direction TB
        
        E40([ğŸ”µ AÃ§Ã£o realizada<br/>no sistema])
        F28[/ğŸ“ Registrar<br/>Log de Auditoria/]
        E41([ğŸŸ¢ AÃ§Ã£o<br/>registrada])
        
        E42([ğŸ”µ Consulta de<br/>auditoria solicitada])
        F29[/ğŸ” Gerar<br/>RelatÃ³rio/]
        E43([ğŸŸ¢ RelatÃ³rio<br/>disponÃ­vel])
        
        E44([ğŸ”µ VerificaÃ§Ã£o<br/>LGPD necessÃ¡ria])
        F30[/âœ… Validar<br/>Conformidade/]
        E45([ğŸŸ¢ Conformidade<br/>verificada])
        
        E40 --> F28 --> E41
        E42 --> F29 --> E43
        E44 --> F30 --> E45
    end

    %% ========================================
    %% CONEXÃ•ES ENTRE PROCESSOS
    %% ========================================
    E2 -.->|Paciente disponÃ­vel| E7
    E6 -.->|Paciente localizado| E12
    E8 -.->|Consulta agendada| E12
    E17 -.->|Atendimento concluÃ­do| E25
    E17 -.->|Dados gerados| E18
    E34 -.->|Acesso autorizado| E36
    E41 -.->|Logs disponÃ­veis| E42

    %% ========================================
    %% LEGENDA
    %% ========================================
    subgraph LEGENDA["ğŸ“– LEGENDA"]
        direction LR
        L1([ğŸ”µ Evento Inicial])
        L2([ğŸŸ¢ Evento Final])
        L3([ğŸŸ¡ Evento IntermediÃ¡rio])
        L4([ğŸ”´ Evento de Erro])
        L5[/ğŸ“ FunÃ§Ã£o/Atividade/]
        L6{DecisÃ£o}
    end

    %% Estilos
    classDef evento fill:#e8f4f8,stroke:#2c5282,stroke-width:2px,color:#1a365d
    classDef eventoFinal fill:#f0fff4,stroke:#276749,stroke-width:2px,color:#276749
    classDef eventoPendente fill:#fef3c7,stroke:#d69e2e,stroke-width:2px,color:#744210
    classDef eventoErro fill:#fed7d7,stroke:#c53030,stroke-width:2px,color:#c53030
    classDef funcao fill:#ebf8ff,stroke:#3182ce,stroke-width:2px,color:#2c5282
    classDef decisao fill:#faf5ff,stroke:#805ad5,stroke-width:2px,color:#553c9a
    
    class E1,E3,E5,E7,E10,E12,E18,E20,E22,E25,E28,E31,E36,E38,E40,E42,E44 evento
    class E2,E4,E6,E8,E9,E11,E13,E14,E15,E16,E17,E19,E21,E23,E26,E27,E29,E30,E33,E34,E37,E39,E41,E43,E45 eventoFinal
    class E32 eventoPendente
    class E24,E35 eventoErro
    class F1,F2,F3,F4,F5,F6,F7,F8,F9,F10,F11,F12,F13,F14,F15,F16,F17,F18,F19,F20,F21,F22,F23,F24,F25,F26,F27,F28,F29,F30 funcao
    class X1,X2,X3,X4,X5 decisao
