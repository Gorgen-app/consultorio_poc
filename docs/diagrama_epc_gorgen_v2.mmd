%%{init: {'theme': 'base', 'themeVariables': { 'fontSize': '14px', 'primaryColor': '#e3f2fd', 'primaryTextColor': '#1565c0', 'primaryBorderColor': '#1976d2', 'lineColor': '#616161', 'secondaryColor': '#e8f5e9', 'tertiaryColor': '#fff8e1'}}}%%
flowchart TB
    %% ========================================
    %% TÃTULO
    %% ========================================
    subgraph HEADER[" "]
        direction LR
        TITLE["ğŸ¥ <b>GORGEN - Sistema de GestÃ£o em SaÃºde</b><br/>Diagrama EPC - Event-driven Process Chain"]
    end

    %% ========================================
    %% FLUXO PRINCIPAL - JORNADA DO PACIENTE
    %% ========================================
    
    %% ENTRADA
    START([ğŸ”µ Paciente entra<br/>em contato])
    
    %% CADASTRO
    subgraph CADASTRO["1ï¸âƒ£ CADASTRO"]
        C1{Paciente<br/>cadastrado?}
        C2[/ğŸ“ Cadastrar<br/>Paciente/]
        C3([âœ… Paciente<br/>registrado])
    end
    
    %% AGENDAMENTO
    subgraph AGENDA["2ï¸âƒ£ AGENDAMENTO"]
        A1[/ğŸ“… Verificar<br/>Disponibilidade/]
        A2{HorÃ¡rio<br/>livre?}
        A3[/âœ… Agendar<br/>Consulta/]
        A4([ğŸ“† Consulta<br/>agendada])
        A5[/ğŸ“§ Enviar<br/>ConfirmaÃ§Ã£o/]
    end
    
    %% ATENDIMENTO
    subgraph ATEND["3ï¸âƒ£ ATENDIMENTO"]
        T1([ğŸ”µ Paciente<br/>chega])
        T2[/ğŸ“‹ Iniciar<br/>Atendimento/]
        T3[/ğŸ“ Registrar<br/>EvoluÃ§Ã£o SOAP/]
        T4{Exames?}
        T5[/ğŸ“„ Solicitar<br/>Exames/]
        T6{Receita?}
        T7[/ğŸ’Š Emitir<br/>PrescriÃ§Ã£o/]
        T8[/âœ… Finalizar<br/>Atendimento/]
        T9([ğŸŸ¢ Atendimento<br/>concluÃ­do])
    end
    
    %% PRONTUÃRIO
    subgraph PRONT["4ï¸âƒ£ PRONTUÃRIO"]
        P1[/ğŸ“ Atualizar<br/>ProntuÃ¡rio/]
        P2[/ğŸ“¤ Upload<br/>Documentos/]
        P3[/ğŸ¤– Extrair<br/>OCR/IA/]
        P4([ğŸ“Š Dados<br/>indexados])
    end
    
    %% FATURAMENTO
    subgraph FATUR["5ï¸âƒ£ FATURAMENTO"]
        F1[/ğŸ’µ Calcular<br/>HonorÃ¡rios/]
        F2[/ğŸ“¨ Enviar<br/>Fatura/]
        F3{Pagamento<br/>recebido?}
        F4[/âœ… Registrar<br/>Pagamento/]
        F5([ğŸ’° Faturamento<br/>concluÃ­do])
    end
    
    %% COMPARTILHAMENTO
    subgraph SHARE["6ï¸âƒ£ CROSS-TENANT"]
        S1([ğŸ”µ SolicitaÃ§Ã£o<br/>de acesso])
        S2[/ğŸ“© Criar<br/>SolicitaÃ§Ã£o/]
        S3{Paciente<br/>autoriza?}
        S4[/âœ… Aprovar<br/>+ LGPD/]
        S5([ğŸ”“ Acesso<br/>liberado])
        S6[/ğŸ“ Log<br/>Auditoria/]
    end
    
    %% AUDITORIA
    subgraph AUDIT["7ï¸âƒ£ AUDITORIA"]
        AU1[/ğŸ“ Registrar<br/>AÃ§Ãµes/]
        AU2([ğŸ”’ Conformidade<br/>LGPD])
    end

    %% ========================================
    %% CONEXÃ•ES DO FLUXO PRINCIPAL
    %% ========================================
    
    START --> C1
    C1 -->|NÃ£o| C2 --> C3
    C1 -->|Sim| A1
    C3 --> A1
    
    A1 --> A2
    A2 -->|Sim| A3 --> A4 --> A5
    A2 -->|NÃ£o| A1
    
    A5 -.->|Dia da consulta| T1
    T1 --> T2 --> T3 --> T4
    T4 -->|Sim| T5 --> T6
    T4 -->|NÃ£o| T6
    T6 -->|Sim| T7 --> T8
    T6 -->|NÃ£o| T8
    T8 --> T9
    
    T9 --> P1
    P1 --> P2
    P2 --> P3 --> P4
    
    T9 --> F1
    F1 --> F2 --> F3
    F3 -->|Sim| F4 --> F5
    F3 -->|NÃ£o| F2
    
    S1 --> S2 --> S3
    S3 -->|Sim| S4 --> S5 --> S6
    S3 -->|NÃ£o| S7([âŒ Negado])
    
    P4 -.-> S1
    T9 --> AU1 --> AU2
    S6 --> AU2

    %% ========================================
    %% LEGENDA
    %% ========================================
    subgraph LEG["ğŸ“– LEGENDA"]
        direction LR
        L1([ğŸ”µ Evento<br/>Inicial])
        L2([ğŸŸ¢ Evento<br/>Final])
        L3[/ğŸ“ FunÃ§Ã£o/<br/>Atividade/]
        L4{DecisÃ£o/<br/>Gateway}
    end

    %% ========================================
    %% ESTILOS
    %% ========================================
    classDef eventoInicial fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#0d47a1
    classDef eventoFinal fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#1b5e20
    classDef eventoErro fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#b71c1c
    classDef funcao fill:#fff8e1,stroke:#f9a825,stroke-width:2px,color:#e65100
    classDef decisao fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c
    classDef subgraphStyle fill:#fafafa,stroke:#bdbdbd,stroke-width:1px
    
    class START,T1,S1 eventoInicial
    class C3,A4,T9,P4,F5,S5,AU2 eventoFinal
    class S7 eventoErro
    class C2,A1,A3,A5,T2,T3,T5,T7,T8,P1,P2,P3,F1,F2,F4,S2,S4,S6,AU1 funcao
    class C1,A2,T4,T6,F3,S3 decisao
