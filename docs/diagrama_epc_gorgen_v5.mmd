%%{init: {'theme': 'base', 'themeVariables': { 'fontSize': '14px', 'primaryColor': '#e3f2fd', 'primaryTextColor': '#1565c0', 'primaryBorderColor': '#1976d2', 'lineColor': '#616161', 'secondaryColor': '#e8f5e9', 'tertiaryColor': '#fff8e1'}}}%%
flowchart TB
    %% ========================================
    %% TÃTULO
    %% ========================================
    subgraph HEADER[" "]
        direction LR
        TITLE["ğŸ¥ <b>GORGEN - Sistema de GestÃ£o em SaÃºde</b><br/>Diagrama EPC - Event-driven Process Chain v5"]
    end

    %% ========================================
    %% FLUXO PRINCIPAL - JORNADA DO PACIENTE
    %% ========================================
    
    %% ENTRADA
    START([ğŸ”µ Paciente entra<br/>em contato])
    
    %% VERIFICAÃ‡ÃƒO INICIAL
    subgraph VERIF["1ï¸âƒ£ VERIFICAÃ‡ÃƒO INICIAL"]
        V1{Paciente jÃ¡<br/>cadastrado?}
        V2{Cadastrado<br/>neste tenant?}
    end
    
    %% CADASTRO (paciente novo)
    subgraph CADASTRO["2ï¸âƒ£ CADASTRO"]
        C1[/ğŸ“ Cadastrar<br/>Paciente/]
        C2([âœ… Paciente<br/>registrado])
    end
    
    %% COMPARTILHAMENTO PARCIAL AUTOMÃTICO
    subgraph PARCIAL["3ï¸âƒ£ COMPARTILHAMENTO PARCIAL<br/>ğŸ”“ AutomÃ¡tico - Sem autorizaÃ§Ã£o"]
        PA1[/ğŸ“‹ Importar Dados<br/>Cadastrais/]
        PA2([âœ… Cadastro<br/>importado])
        PA3[/ğŸ“… Importar Timeline<br/>de Atendimentos/]
        PA4([ğŸ“Š Timeline<br/>visÃ­vel<br/>sem conteÃºdo])
        PA5[/âš ï¸ Importar<br/>Alergias/]
        PA6[/ğŸ’Š Importar<br/>Medicamentos/]
        PA7([ğŸ”’ Dados de<br/>seguranÃ§a<br/>disponÃ­veis])
    end
    
    %% SOLICITAÃ‡ÃƒO DE ACESSO COMPLETO
    subgraph COMPLETO["4ï¸âƒ£ ACESSO AO CONTEÃšDO CLÃNICO<br/>ğŸ” Requer autorizaÃ§Ã£o LGPD"]
        CT1{MÃ©dico precisa<br/>ver conteÃºdo?}
        CT2[/ğŸ“© Solicitar Acesso<br/>ao ProntuÃ¡rio/]
        CT3([ğŸŸ¡ Aguardando<br/>autorizaÃ§Ã£o])
        CT4{Paciente<br/>autoriza?}
        CT5[/âœ… Aprovar com<br/>Consentimento LGPD/]
        CT6([ğŸ”“ ConteÃºdo<br/>liberado])
        CT7[/ğŸ“– Exibir<br/>ProntuÃ¡rio Completo/]
        CT8([ğŸ“‹ ProntuÃ¡rio<br/>disponÃ­vel])
        CT9([âŒ Acesso ao<br/>conteÃºdo negado])
        CT10[/ğŸ“ Registrar<br/>Log Auditoria/]
    end
    
    %% AGENDAMENTO
    subgraph AGENDA["5ï¸âƒ£ AGENDAMENTO"]
        A1[/ğŸ“… Verificar<br/>Disponibilidade/]
        A2{HorÃ¡rio<br/>livre?}
        A3[/âœ… Agendar<br/>Consulta/]
        A4([ğŸ“† Consulta<br/>agendada])
        A5[/ğŸ“§ Enviar<br/>ConfirmaÃ§Ã£o/]
    end
    
    %% ATENDIMENTO
    subgraph ATEND["6ï¸âƒ£ ATENDIMENTO"]
        T1([ğŸ”µ Paciente<br/>chega])
        T2[/ğŸ“‹ Iniciar<br/>Atendimento/]
        T3[/ğŸ“ Registrar<br/>EvoluÃ§Ã£o SOAP/]
        T4{Exames?}
        T5[/ğŸ“„ Solicitar<br/>Exames/]
        T6{Receita?}
        T7[/ğŸ’Š Emitir<br/>PrescriÃ§Ã£o/]
        T8[/âœ… Finalizar<br/>Atendimento/]
        T9([ğŸŸ¢ Atendimento<br/>concluÃ­do])
    end
    
    %% PRONTUÃRIO
    subgraph PRONT["7ï¸âƒ£ PRONTUÃRIO"]
        P1[/ğŸ“ Atualizar<br/>ProntuÃ¡rio/]
        P2[/ğŸ“¤ Upload<br/>Documentos/]
        P3[/ğŸ¤– Extrair<br/>OCR/IA/]
        P4([ğŸ“Š Dados<br/>indexados])
    end
    
    %% FATURAMENTO
    subgraph FATUR["8ï¸âƒ£ FATURAMENTO"]
        F1[/ğŸ’µ Calcular<br/>HonorÃ¡rios/]
        F2[/ğŸ“¨ Enviar<br/>Fatura/]
        F3{Pagamento<br/>recebido?}
        F4[/âœ… Registrar<br/>Pagamento/]
        F5([ğŸ’° Faturamento<br/>concluÃ­do])
    end
    
    %% AUDITORIA
    subgraph AUDIT["9ï¸âƒ£ AUDITORIA"]
        AU1[/ğŸ“ Registrar<br/>AÃ§Ãµes/]
        AU2([ğŸ”’ Conformidade<br/>LGPD])
    end

    %% ========================================
    %% CONEXÃ•ES DO FLUXO PRINCIPAL
    %% ========================================
    
    %% Entrada e verificaÃ§Ã£o
    START --> V1
    
    %% Paciente NÃƒO cadastrado â†’ Cadastro novo
    V1 -->|NÃ£o| C1 --> C2 --> A1
    
    %% Paciente JÃ cadastrado â†’ verificar onde
    V1 -->|Sim| V2
    
    %% Cadastrado NESTE tenant â†’ direto para agendamento
    V2 -->|Sim| A1
    
    %% Cadastrado em OUTRO tenant â†’ Compartilhamento Parcial AutomÃ¡tico
    V2 -->|NÃ£o, em<br/>outro tenant| PA1
    
    %% ========================================
    %% FLUXO DE COMPARTILHAMENTO PARCIAL
    %% ========================================
    PA1 --> PA2 --> PA3 --> PA4
    PA2 --> PA5 --> PA7
    PA2 --> PA6 --> PA7
    PA4 --> CT1
    PA7 --> CT1
    
    %% ========================================
    %% FLUXO DE ACESSO AO CONTEÃšDO CLÃNICO
    %% ========================================
    CT1 -->|Sim| CT2 --> CT3 --> CT4
    CT1 -->|NÃ£o, dados<br/>bÃ¡sicos suficientes| A1
    
    CT4 -->|Sim| CT5 --> CT6 --> CT10 --> CT7 --> CT8 --> A1
    CT4 -->|NÃ£o| CT9 --> A1
    
    %% ========================================
    %% FLUXO DE AGENDAMENTO
    %% ========================================
    A1 --> A2
    A2 -->|Sim| A3 --> A4 --> A5
    A2 -->|NÃ£o| A1
    
    %% Dia da consulta
    A5 -.->|Dia da consulta| T1
    
    %% ========================================
    %% FLUXO DE ATENDIMENTO
    %% ========================================
    T1 --> T2 --> T3 --> T4
    T4 -->|Sim| T5 --> T6
    T4 -->|NÃ£o| T6
    T6 -->|Sim| T7 --> T8
    T6 -->|NÃ£o| T8
    T8 --> T9
    
    %% ========================================
    %% PÃ“S-ATENDIMENTO
    %% ========================================
    T9 --> P1
    P1 --> P2
    P2 --> P3 --> P4
    
    T9 --> F1
    F1 --> F2 --> F3
    F3 -->|Sim| F4 --> F5
    F3 -->|NÃ£o| F2
    
    %% ========================================
    %% AUDITORIA
    %% ========================================
    T9 --> AU1 --> AU2
    CT10 --> AU2

    %% ========================================
    %% LEGENDA
    %% ========================================
    subgraph LEG["ğŸ“– LEGENDA"]
        direction LR
        L1([ğŸ”µ Evento<br/>Inicial])
        L2([ğŸŸ¢ Evento<br/>Final])
        L3([ğŸŸ¡ Aguardando])
        L4([ğŸ”“ Liberado])
        L5([ğŸ”’ Protegido])
        L6[/ğŸ“ FunÃ§Ã£o/]
        L7{DecisÃ£o}
    end

    %% ========================================
    %% QUADRO DE DADOS
    %% ========================================
    subgraph DADOS["ğŸ“Š NÃVEIS DE COMPARTILHAMENTO"]
        direction TB
        D1["ğŸ”“ <b>AUTOMÃTICO</b><br/>â€¢ Dados cadastrais<br/>â€¢ Alergias<br/>â€¢ Medicamentos em uso<br/>â€¢ Timeline (datas)"]
        D2["ğŸ” <b>COM AUTORIZAÃ‡ÃƒO</b><br/>â€¢ EvoluÃ§Ãµes SOAP<br/>â€¢ DiagnÃ³sticos/CID<br/>â€¢ Resultados de exames<br/>â€¢ Laudos e documentos"]
    end

    %% ========================================
    %% ESTILOS
    %% ========================================
    classDef eventoInicial fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#0d47a1
    classDef eventoFinal fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#1b5e20
    classDef eventoPendente fill:#fff8e1,stroke:#f9a825,stroke-width:2px,color:#e65100
    classDef eventoLiberado fill:#e8f5e9,stroke:#43a047,stroke-width:2px,color:#1b5e20
    classDef eventoProtegido fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#0d47a1
    classDef eventoErro fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#b71c1c
    classDef funcao fill:#fff3e0,stroke:#ff9800,stroke-width:2px,color:#e65100
    classDef decisao fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c
    classDef dados fill:#e8eaf6,stroke:#3f51b5,stroke-width:1px,color:#1a237e
    
    class START,T1 eventoInicial
    class C2,PA2,PA4,PA7,CT6,CT8,A4,T9,P4,F5,AU2 eventoFinal
    class CT3 eventoPendente
    class CT9 eventoErro
    class C1,A1,A3,A5,T2,T3,T5,T7,T8,P1,P2,P3,F1,F2,F4,PA1,PA3,PA5,PA6,CT2,CT5,CT7,CT10,AU1 funcao
    class V1,V2,A2,T4,T6,F3,CT1,CT4 decisao
    class D1,D2 dados
